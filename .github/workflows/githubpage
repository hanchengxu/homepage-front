name: Build and Deploy HomePage
# on:
#  push:
#   branches:
#     - master
#   paths-ignore:
#     - '.github/**'
#     - 'README.md'
#  pull_request:
#   branches:
#     - master
#   paths-ignore:
#     - '.github/**'
#     - 'README.md'
on:
  workflow_dispatch:
# on:
#   watch:
#     types: started
jobs:
 build-and-deploy:
  runs-on: ubuntu-latest
  steps:
  - name: Checkout
    uses: actions/checkout@master # 将代码拷贝到虚机中
    with:
     persist-credentials: false
  - name: Install and Build ⚙️
    run: |
     npm install
     npm run-script build
  - name: Deploy
    uses: peaceiris/actions-gh-pages@v3
    with:
      github_token: ${{ secrets.GITHUB_TOKEN }}
      publish_branch: gh-pages
      publish_dir: ./dist
      keep_files: true
  - name: show my IP
    run: |
     curl ifconfig.me
  - name: Deploy to Server
    uses: easingthemes/ssh-deploy@main
    env:
        SSH_PRIVATE_KEY: ${{ secrets.SERVER_SSH_KEY }}
        ARGS: "-rltgoDzvO --delete"
        SOURCE: "dist/"
        REMOTE_HOST: ${{ secrets.REMOTE_HOST }}
        REMOTE_USER: ${{ secrets.REMOTE_USER }}
        TARGET: ${{ secrets.REMOTE_TARGET }}
        EXCLUDE: "/node_modules/"
